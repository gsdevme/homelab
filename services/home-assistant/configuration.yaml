homeassistant:
  name: Home
  unit_system: metric
  customize: !include customize.yaml
  latitude: !env_var LATITUDE 0.0
  longitude: !env_var LONGITUDE 0.0

http:
  use_x_forwarded_for: true
  login_attempts_threshold: 10
  ip_ban_enabled: true
  trusted_proxies:
    - 172.16.16.0/24
    - 10.0.0.0/8

mqtt:
  broker: !env_var MQTT_HOST 127.0.0.1

recorder:
  purge_keep_days: 14
  include:
    domains:
      - sensor
      - switch
      - media_player
      - alarm_control_panel
      - person
      - vacuum
      - binary_sensor
      - plant
      - camera
      - sun
  db_url: !env_var RECORDER_DSN sqlite:////config/home-assistant.sqlite

weather:
frontend:

synology_dsm:
  - host: !env_var DSM_HOST 127.0.0.1
    username: !env_var DSM_USERNAME home-assistant
    password: !env_var DSM_PASSWORD home-assistant

mobile_app:
discovery:
ios:
map:
history:
sun:

zone:
  - name: Home
    latitude: !env_var LATITUDE 0.0
    longitude: !env_var LONGITUDE 0.0
    radius: 90
    icon: mdi:home

plant:
  kitchen_plant:
    sensors:
      moisture: sensor.mqtt_kitchen_plant_moisture
      conductivity: sensor.mqtt_kitchen_plant_conductivity
      temperature: sensor.mqtt_kitchen_plant_temperature
    min_moisture: 20
    max_moisture: 60
    min_conductivity: 150
    max_conductivity: 600
    min_temperature: 10

sensor: !include_dir_merge_list sensors/
binary_sensor: !include_dir_merge_list binary-sensors/
switch: !include_dir_merge_list switches/

neato:
  username: !env_var NEATO_USERNAME ""
  password: !env_var NEATO_PASSWORD ""

lovelace:
  mode: yaml
  resources:
    - url: /local/vacuum-card.js
      type: module
    - url: /local/auto-entities.js
      type: module
    - url: /local/layout-card.js
      type: module

alarm_control_panel:
  # The manual Alarm
  - platform: mqtt
    code_arm_required: false
    state_topic: "homeassistant/alarm/state"
    command_topic: "homeassistant/alarm/state"
    payload_disarm: "disarmed"
    payload_arm_away: "armed_away"
    payload_arm_home: "armed_home"
    payload_arm_night: "armed_night"
    retain: true
 # The automated Alarm
  - platform: template
    panels:
      #
      # 1. if the manual alarm is armed then arm
      # 2. if someone is home dont set
      # 3. default set the alarm
      #
      automated_alarm_panel:
        code_arm_required: false
        value_template: >-
          {% if is_state('alarm_control_panel.mqtt_alarm', 'armed_away') %}
            armed_away
          {% elif is_state('alarm_control_panel.mqtt_alarm', 'armed_home') %}
            armed_home
          {% elif is_state('binary_sensor.people_home', 'on') %}
            disarmed
          {% else %}
            armed_away
          {% endif %}
        # Disarm the manual alarm also
        disarm:
          service: alarm_control_panel.alarm_arm_home
          data:
            entity_id: alarm_control_panel.mqtt_alarm

tts:
  - platform: google_translate

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

device_tracker:
  - platform: mqtt
    devices:
      gavin_phone_via_mqtt: 'homeassistant/person_tracker/location/gavin'
      ceilidh_phone_via_mqtt: 'homeassistant/person_tracker/location/ceilidh'
    qos: 1

person:
  - name: Gavin
    id: gavin
    device_trackers:
      - device_tracker.gavin_phone_via_mqtt
    user_id: 101
  - name: Ceilidh
    id: ceilidh
    user_id: 102
    device_trackers:
      - device_tracker.ceilidh_phone_via_mqtt
